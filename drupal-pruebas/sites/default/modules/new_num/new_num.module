<?php
// $Id$

/**
 * @file
 * A module what to create a new number in the site.
*/
function new_num_help($path, $arg) {
  if ($path == 'admin/help#new_num') {
    return t('A module to create a new number in the site.');
  }
}

function new_num_menu() {
  $items = array();

  $items['admin/config/development/new_num'] = array(
    'title' => 'New number',
    'description' => 'New number',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('new_num_form'),
    'access arguments' => array('administer site configuration'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

function new_num_form($form, &$form_state) {
  // Number
  $form['bbdd_data'] = array(
    '#type' => 'fieldset',
    '#title' => t('Datos de conexión con la base de datos'),
    '#collapsible' => TRUE,
    '#collapsed' => TRUE,
  );
  $form['bbdd_data']['new_form-bbdd'] = array(
    '#type' => 'textfield',
    '#title' => t('Nombre de la base de datos'),
    '#size' => 10,
    '#maxlength' => 20,
    '#description' => t('Por su seguridad indique a la base de datos que quiere conectar'),
    '#required' => TRUE,
    '#attributes' => array('autocomplete'=>'off'),
    '#group' => 'bbdd_data',
  );
  // Number
  $form['bbdd_data']['new_form-user'] = array(
    '#type' => 'textfield',
    '#title' => t('Nombre de usuario'),
    '#size' => 10,
    '#maxlength' => 20,
    '#description' => t('Por su seguridad indique el nombre de usuario de la base de datos'),
    '#required' => TRUE,
    '#attributes' => array('autocomplete'=>'off'),
    '#group' => 'bbdd_data',
  );
  // Number
  $form['bbdd_data']['new_form-pass'] = array(
    '#type' => 'textfield',
    '#title' => t('Contraseña de la base de datos'),
    '#size' => 10,
    '#maxlength' => 20,
    '#description' => t('Introduzca la password de la base de datos'),
    '#required' => TRUE,
    '#attributes' => array('autocomplete'=>'off'),
    '#group' => 'bbdd_data',
  );
  // Number
  $form['new_form-number'] = array(
    '#type' => 'textfield',
    '#title' => t('New number'),
    '#size' => 10,
    '#maxlength' => 4,
    '#description' => t('Indicate the name for the new number'),
    '#required' => TRUE,
  );
  // Date
  $form['new_form-date'] = array(
    '#type' => 'textfield',
    '#title' => t('Date of the new number'),
    '#size' => 60,
    '#maxlength' => 64,
    '#description' => t('Indicate the date for the new number'),
    '#required' => TRUE,
  ); 
  // Year
  $form['new_form-year'] = array(
    '#type' => 'textfield',
    '#title' => t('Year'),
    '#size' => 10,
    '#maxlength' => 6,
    '#description' => t('Indicate the year for the new number'),
    '#required' => TRUE,
  );
  // Submit button 
  $form['submit'] = array( 
    '#type' => 'submit', 
    '#value' => t('Create new number'), 
  );

  return $form;
}

function new_num_form_submit($form, &$form_state) {
  $number = $form_state['values']['new_form-number'];
  $date = $form_state['values']['new_form-date'];
  $year = $form_state['values']['new_form-year'];
  $bbdd = $form_state['values']['new_form-bbdd'];
  $user = $form_state['values']['new_form-user'];
  $pass = $form_state['values']['new_form-pass'];
  create_tables($number);
  insert_data($number);
  create_directory($number);
  create_setting_file($number,$date,$year,$bbdd,$user,$pass);
}

/**
* XX_cache
* XX_cache_bootstrap
* XX_cache_field
* XX_cache_menu
* XX_field_data_body
* XX_field_revision_body
* XX_field_data_field_texto_imprimible
* XX_field_revision_field_texto_imprimible
* XX_node
* XX_node_revision
* XX_field_collection_item
* XX_node_comment_statistics
* XX_search_dataset
* XX_search_index
* XX_search_node_links
* XX_search_total
* XX_variable
*/
function create_tables($number) {
  // Use the Database API to retrieve our data.  // @see http://drupal.org/node/310069
  
  // Field
  $autoincrement_collection = get_autoincrement($number,'field_collection_item');
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_field_collection_item` (
  `item_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'Primary Key: Unique field-collection item ID.',
  `field_name` varchar(32) NOT NULL COMMENT 'The name of the field on the host entity embedding this entity.',
  PRIMARY KEY (`item_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='Stores information about field-collection items.' AUTO_INCREMENT=".$autoincrement_collection." ;");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_field_data_body` (
  `entity_type` varchar(128) NOT NULL DEFAULT '' COMMENT 'The entity type this data is attached to',
  `bundle` varchar(128) NOT NULL DEFAULT '' COMMENT 'The field instance bundle to which this row belongs, used when deleting a field instance',
  `deleted` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'A boolean indicating whether this data item has been deleted',
  `entity_id` int(10) unsigned NOT NULL COMMENT 'The entity id this data is attached to',
  `revision_id` int(10) unsigned DEFAULT NULL COMMENT 'The entity revision id this data is attached to, or NULL if the entity type is not versioned',
  `language` varchar(32) NOT NULL DEFAULT '' COMMENT 'The language for this data item.',
  `delta` int(10) unsigned NOT NULL COMMENT 'The sequence number for this data item, used for multi-value fields',
  `body_value` longtext,
  `body_summary` longtext,
  `body_format` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`entity_type`,`entity_id`,`deleted`,`delta`,`language`),
  KEY `entity_type` (`entity_type`),
  KEY `bundle` (`bundle`),
  KEY `deleted` (`deleted`),
  KEY `entity_id` (`entity_id`),
  KEY `revision_id` (`revision_id`),
  KEY `language` (`language`),
  KEY `body_format` (`body_format`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Data storage for field 2 (body)';");
  drupal_set_message(t(''));
  
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_field_data_field_texto_imprimible` (
  `entity_type` varchar(128) NOT NULL DEFAULT '' COMMENT 'The entity type this data is attached to',
  `bundle` varchar(128) NOT NULL DEFAULT '' COMMENT 'The field instance bundle to which this row belongs, used when deleting a field instance',
  `deleted` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'A boolean indicating whether this data item has been deleted',
  `entity_id` int(10) unsigned NOT NULL COMMENT 'The entity id this data is attached to',
  `revision_id` int(10) unsigned DEFAULT NULL COMMENT 'The entity revision id this data is attached to, or NULL if the entity type is not versioned',
  `language` varchar(32) NOT NULL DEFAULT '' COMMENT 'The language for this data item.',
  `delta` int(10) unsigned NOT NULL COMMENT 'The sequence number for this data item, used for multi-value fields',
  `field_texto_imprimible_value` longtext,
  `field_texto_imprimible_format` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`entity_type`,`entity_id`,`deleted`,`delta`,`language`),
  KEY `entity_type` (`entity_type`),
  KEY `bundle` (`bundle`),
  KEY `deleted` (`deleted`),
  KEY `entity_id` (`entity_id`),
  KEY `revision_id` (`revision_id`),
  KEY `language` (`language`),
  KEY `field_texto_imprimible_format` (`field_texto_imprimible_format`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Data storage for field 22 (field_texto_imprimible)';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_field_revision_body` (
  `entity_type` varchar(128) NOT NULL DEFAULT '' COMMENT 'The entity type this data is attached to',
  `bundle` varchar(128) NOT NULL DEFAULT '' COMMENT 'The field instance bundle to which this row belongs, used when deleting a field instance',
  `deleted` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'A boolean indicating whether this data item has been deleted',
  `entity_id` int(10) unsigned NOT NULL COMMENT 'The entity id this data is attached to',
  `revision_id` int(10) unsigned NOT NULL COMMENT 'The entity revision id this data is attached to',
  `language` varchar(32) NOT NULL DEFAULT '' COMMENT 'The language for this data item.',
  `delta` int(10) unsigned NOT NULL COMMENT 'The sequence number for this data item, used for multi-value fields',
  `body_value` longtext,
  `body_summary` longtext,
  `body_format` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`entity_type`,`entity_id`,`revision_id`,`deleted`,`delta`,`language`),
  KEY `entity_type` (`entity_type`),
  KEY `bundle` (`bundle`),
  KEY `deleted` (`deleted`),
  KEY `entity_id` (`entity_id`),
  KEY `revision_id` (`revision_id`),
  KEY `language` (`language`),
  KEY `body_format` (`body_format`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Revision archive storage for field 2 (body)';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_field_revision_field_texto_imprimible` (
  `entity_type` varchar(128) NOT NULL DEFAULT '' COMMENT 'The entity type this data is attached to',
  `bundle` varchar(128) NOT NULL DEFAULT '' COMMENT 'The field instance bundle to which this row belongs, used when deleting a field instance',
  `deleted` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'A boolean indicating whether this data item has been deleted',
  `entity_id` int(10) unsigned NOT NULL COMMENT 'The entity id this data is attached to',
  `revision_id` int(10) unsigned NOT NULL COMMENT 'The entity revision id this data is attached to',
  `language` varchar(32) NOT NULL DEFAULT '' COMMENT 'The language for this data item.',
  `delta` int(10) unsigned NOT NULL COMMENT 'The sequence number for this data item, used for multi-value fields',
  `field_texto_imprimible_value` longtext,
  `field_texto_imprimible_format` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`entity_type`,`entity_id`,`revision_id`,`deleted`,`delta`,`language`),
  KEY `entity_type` (`entity_type`),
  KEY `bundle` (`bundle`),
  KEY `deleted` (`deleted`),
  KEY `entity_id` (`entity_id`),
  KEY `revision_id` (`revision_id`),
  KEY `language` (`language`),
  KEY `field_texto_imprimible_format` (`field_texto_imprimible_format`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Revision archive storage for field 22 (field_texto...';");
  drupal_set_message(t(''));

  // Caches
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_cache` (
  `cid` varchar(255) NOT NULL DEFAULT '' COMMENT 'Primary Key: Unique cache ID.',
  `data` longblob COMMENT 'A collection of data to cache.',
  `expire` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry should expire, or 0 for never.',
  `created` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry was created.',
  `serialized` smallint(6) NOT NULL DEFAULT '0' COMMENT 'A flag to indicate whether content is serialized (1) or not (0).',
  PRIMARY KEY (`cid`),
  KEY `expire` (`expire`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Generic cache table for caching things not separated out...';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_cache_bootstrap` (
  `cid` varchar(255) NOT NULL DEFAULT '' COMMENT 'Primary Key: Unique cache ID.',
  `data` longblob COMMENT 'A collection of data to cache.',
  `expire` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry should expire, or 0 for never.',
  `created` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry was created.',
  `serialized` smallint(6) NOT NULL DEFAULT '0' COMMENT 'A flag to indicate whether content is serialized (1) or not (0).',
  PRIMARY KEY (`cid`),
  KEY `expire` (`expire`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Cache table for data required to bootstrap Drupal, may be...';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_cache_field` (
  `cid` varchar(255) NOT NULL DEFAULT '' COMMENT 'Primary Key: Unique cache ID.',
  `data` longblob COMMENT 'A collection of data to cache.',
  `expire` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry should expire, or 0 for never.',
  `created` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry was created.',
  `serialized` smallint(6) NOT NULL DEFAULT '0' COMMENT 'A flag to indicate whether content is serialized (1) or not (0).',
  PRIMARY KEY (`cid`),
  KEY `expire` (`expire`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Generic cache table for caching things not separated out...';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_cache_menu` (
  `cid` varchar(255) NOT NULL DEFAULT '' COMMENT 'Primary Key: Unique cache ID.',
  `data` longblob COMMENT 'A collection of data to cache.',
  `expire` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry should expire, or 0 for never.',
  `created` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when the cache entry was created.',
  `serialized` smallint(6) NOT NULL DEFAULT '0' COMMENT 'A flag to indicate whether content is serialized (1) or not (0).',
  PRIMARY KEY (`cid`),
  KEY `expire` (`expire`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Cache table for the menu system to store router...';");
  drupal_set_message(t(''));

  // Node
  $autoincrement_node = get_autoincrement($number,'node');
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_node` (
  `nid` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'The primary identifier for a node.',
  `vid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The current node_revision.vid version identifier.',
  `type` varchar(32) NOT NULL DEFAULT '' COMMENT 'The node_type.type of this node.',
  `language` varchar(12) NOT NULL DEFAULT '' COMMENT 'The languages.language of this node.',
  `title` varchar(255) NOT NULL DEFAULT '' COMMENT 'The title of this node, always treated as non-markup plain text.',
  `uid` int(11) NOT NULL DEFAULT '0' COMMENT 'The users.uid that owns this node; initially, this is the user that created it.',
  `status` int(11) NOT NULL DEFAULT '1' COMMENT 'Boolean indicating whether the node is published (visible to non-administrators).',
  `created` int(11) NOT NULL DEFAULT '0' COMMENT 'The Unix timestamp when the node was created.',
  `changed` int(11) NOT NULL DEFAULT '0' COMMENT 'The Unix timestamp when the node was most recently saved.',
  `comment` int(11) NOT NULL DEFAULT '0' COMMENT 'Whether comments are allowed on this node: 0 = no, 1 = closed (read only), 2 = open (read/write).',
  `promote` int(11) NOT NULL DEFAULT '0' COMMENT 'Boolean indicating whether the node should be displayed on the front page.',
  `sticky` int(11) NOT NULL DEFAULT '0' COMMENT 'Boolean indicating whether the node should be displayed at the top of lists in which it appears.',
  `tnid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The translation set id for this node, which equals the node id of the source post in each set.',
  `translate` int(11) NOT NULL DEFAULT '0' COMMENT 'A boolean indicating whether this translation page needs to be updated.',
  PRIMARY KEY (`nid`),
  UNIQUE KEY `vid` (`vid`),
  KEY `node_changed` (`changed`),
  KEY `node_created` (`created`),
  KEY `node_frontpage` (`promote`,`status`,`sticky`,`created`),
  KEY `node_status_type` (`status`,`type`,`nid`),
  KEY `node_title_type` (`title`,`type`(4)),
  KEY `node_type` (`type`(4)),
  KEY `uid` (`uid`),
  KEY `tnid` (`tnid`),
  KEY `translate` (`translate`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='The base table for nodes.' AUTO_INCREMENT=".$autoincrement_node." ;");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_node_revision` (
  `nid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The node this version belongs to.',
  `vid` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'The primary identifier for this version.',
  `uid` int(11) NOT NULL DEFAULT '0' COMMENT 'The users.uid that created this version.',
  `title` varchar(255) NOT NULL DEFAULT '' COMMENT 'The title of this version.',
  `log` longtext NOT NULL COMMENT 'The log entry explaining the changes in this version.',
  `timestamp` int(11) NOT NULL DEFAULT '0' COMMENT 'A Unix timestamp indicating when this version was created.',
  `status` int(11) NOT NULL DEFAULT '1' COMMENT 'Boolean indicating whether the node (at the time of this revision) is published (visible to non-administrators).',
  `comment` int(11) NOT NULL DEFAULT '0' COMMENT 'Whether comments are allowed on this node (at the time of this revision): 0 = no, 1 = closed (read only), 2 = open (read/write).',
  `promote` int(11) NOT NULL DEFAULT '0' COMMENT 'Boolean indicating whether the node (at the time of this revision) should be displayed on the front page.',
  `sticky` int(11) NOT NULL DEFAULT '0' COMMENT 'Boolean indicating whether the node (at the time of this revision) should be displayed at the top of lists in which it appears.',
  PRIMARY KEY (`vid`),
  KEY `nid` (`nid`),
  KEY `uid` (`uid`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='Stores information about each saved version of a node.' AUTO_INCREMENT=".$autoincrement_node." ;");
  drupal_set_message(t(''));
  
  // Search
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_search_dataset` (
  `sid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Search item ID, e.g. node ID for nodes.',
  `type` varchar(16) NOT NULL COMMENT 'Type of item, e.g. node.',
  `data` longtext NOT NULL COMMENT 'List of space-separated words from the item.',
  `reindex` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'Set to force node reindexing.',
  PRIMARY KEY (`sid`,`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Stores items that will be searched.';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_search_index` (
  `word` varchar(50) NOT NULL DEFAULT '' COMMENT 'The ".$number."_search_total.word that is associated with the search item.',
  `sid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The ".$number."_search_dataset.sid of the searchable item to which the word belongs.',
  `type` varchar(16) NOT NULL COMMENT 'The ".$number."_search_dataset.type of the searchable item to which the word belongs.',
  `score` float DEFAULT NULL COMMENT 'The numeric score of the word, higher being more important.',
  PRIMARY KEY (`word`,`sid`,`type`),
  KEY `sid_type` (`sid`,`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Stores the search index, associating words, items and...';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_search_node_links` (
  `sid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The ".$number."_search_dataset.sid of the searchable item containing the link to the node.',
  `type` varchar(16) NOT NULL DEFAULT '' COMMENT 'The ".$number."_search_dataset.type of the searchable item containing the link to the node.',
  `nid` int(10) unsigned NOT NULL DEFAULT '0' COMMENT 'The node.nid that this item links to.',
  `caption` longtext COMMENT 'The text used to link to the node.nid.',
  PRIMARY KEY (`sid`,`type`,`nid`),
  KEY `nid` (`nid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Stores items (like nodes) that link to other nodes, used...';");
  drupal_set_message(t(''));

  db_query("CREATE TABLE IF NOT EXISTS `".$number."_search_total` (
  `word` varchar(50) NOT NULL DEFAULT '' COMMENT 'Primary Key: Unique word in the search index.',
  `count` float DEFAULT NULL COMMENT 'The count of the word in the index using Zipf’s law to equalize the probability distribution.',
  PRIMARY KEY (`word`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Stores search totals for words.';");
  drupal_set_message(t(''));

  // Variables
  db_query("CREATE TABLE IF NOT EXISTS `".$number."_variable` (
  `name` varchar(128) NOT NULL DEFAULT '' COMMENT 'The name of the variable.',
  `value` longblob NOT NULL COMMENT 'The value of the variable.',
  PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Named variable/value pairs created by Drupal core or any...';");
  drupal_set_message(t(''));

  drupal_set_message(t('Number creates right'));
}

/**
* get the autoincrement values for the specific data base
* XX_field_collection_item
*/
function get_autoincrement($number,$table) {
  $number_before = (int)$number - 1;
  $tblName = $number_before."_".$table;
  $dbName = Database::getConnectionInfo()['default']['database'];
  $query = db_query("SELECT Auto_increment FROM information_schema.tables WHERE table_name='".$tblName."' AND table_schema ='".$dbName."';");
  foreach ($query as $result) {
    $result;
  }
  if(isset($result)){
    $nextId = $result->Auto_increment;
    return $nextId;
  }
  return 0;
}

/**
* --36, 47, 48, 49, 50--
* XX_field_data_body
* XX_field_revision_body
* XX_field_data_field_texto_imprimible
* XX_field_revision_field_texto_imprimible
* XX_node
* XX_node_revision
* --All--
* XX_variable
*/
function get_data($number,$table,$id){
  // Use the Database API to retrieve our data.
  // @see http://drupal.org/node/310069
  $query = array();
  $name = str_replace('field_data_', '', $table);

  try {
    foreach ($id as $key => $value) {
      $number_before = (int)$number - 1;
      $nmTable = $number_before.'_'.$table;
      $query = db_select( $nmTable , 'n')
        ->fields('n', array($name.'_value'))
        ->condition('entity_id', $value )
        ->execute();

        foreach ($query as $value) {
          $prop = $name.'_value';
          $results[] = str_replace('\'', '\\\'', $value->$prop);
        }
    }
  }catch(Exception $e) { 
      drupal_set_message(t('An error occurred and processing did not complete in select '.$table.'.'), 'error'); 
      $results = false;
  }
  return $results;
}

function insert_data($number) {

// data_body
  $results = get_data($number,'field_data_body',array(36,47,48,49,50));
  if($results){
    $content = $results;
  }else{
    $content[0] = '<div style="margin-bottom: 31px;" class="columna columna-colaboracion columna-img-entrelineas">\r\n  <p><strong>Director:</strong> Antonio Prada Ramos.<br>\r\n    <strong>Subdirectora:</strong> Nuria Santos de la Calle.<br>\r\n    <strong>Coordinación:</strong> Susana Moreno Martínez.<br>\r\n    <strong>Edición:</strong> Gabinete de Prensa de Red Eléctrica de España.<br>\r\n    <strong>Dirección: </strong>Paseo del Conde de los Gaitanes, 177. 28109 Alcobendas. Madrid.<br>\r\n   <strong>Teléfono:</strong> 91 650 85 00.<br>\r\n    <strong>Fax:</strong> 91 659 99 25.<br>\r\n   <strong>Correo-e:</strong> ree@revistaentrelineas.es<br>\r\n    &nbsp;</p>\r\n  <p>&nbsp;</p>\r\n</div>\r\n<div class="columna columna-colaboracion columna-img-colaboracion">\r\n  <p><strong>Desarrollo:</strong> OpenSistemas, S.L.<br>\r\n    <strong>Dirección:</strong> Calle Castrobarto, 10. 28042 Madrid.<br>\r\n    <strong>Teléfono:</strong> 902 107 396.<br>\r\n   <strong>Fax:</strong> 91 329 58 89.<br>\r\n   <strong>Correo-e:</strong> <a href="mailto:info@opensistemas.com">info@opensistemas.com</a></p>\r\n</div>\r\n<div class="columna columna-colaboracion ">Esta publicación no comparte necesariamente la opinión de sus colaboradores y se limita a ofrecer sus páginas con respeto a la libertad de expresión. La información recogida en esta revista puede ser usada en parte o en su integridad citando la fuente.</div>\r\n';
    $content[1] = '<div class="tabla-contacto">\r\n  <div class="columna columna-contacto">\r\n    <div><strong>Dirección: </strong></div>\r\n   <div>Paseo del Conde de los Gaitanes, 177.<br>\r\n      28109 Alcobendas. Madrid.<br>\r\n     &nbsp;</div>\r\n    <div><strong>Teléfono:</strong> 91 650 85 00.<br>\r\n     &nbsp;</div>\r\n    <div><strong>Fax:</strong> 91 659 99 25.<br>\r\n      &nbsp;</div>\r\n    <div><strong>Correo-e: </strong></div>\r\n    <div>ree@revistaentrelineas.es</div>\r\n    <div>gabinetedeprensa@ree.es</div>\r\n  </div>\r\n  <div class="columna columna-mapa"><iframe class="borde_azul" height="260" marginHeight="0" src="http://maps.google.com/maps?source=s_q&amp;f=q&amp;hl=es&amp;geocode=&amp;q=Paseo+Conde+de+los+Gaitanes,+177,+28109+Alcobendas,+Espa%C3%B1a%E2%80%8E&amp;sll=40.525356,-3.604782&amp;sspn=0.007429,0.00986&amp;ie=UTF8&amp;hq=&amp;hnear=Paseo+Conde+de+los+Gaitanes,+177,+28109+Alcobendas,+Comunidad+de+Madrid,+Espa%C3%B1a&amp;vpsrc=0&amp;ll=40.527958,-3.602057&amp;spn=0.022344,0.045447&amp;t=m&amp;z=14&amp;output=embed" frameBorder="0" width="600" marginWidth="0" scrolling="no" rel="lightbox"></iframe>\r\n   <p style="margin: 0px;"><span class="negro"><a href="http://maps.google.com/maps?f=q&amp;source=embed&amp;hl=es&amp;geocode=&amp;q=Paseo+Conde+de+los+Gaitanes,+177,+28109+Alcobendas,+Espa%C3%B1a%E2%80%8E&amp;sll=40.525356,-3.604782&amp;sspn=0.007429,0.00986&amp;ie=UTF8&amp;hq=&amp;hnear=Paseo+Conde+de+los+Gaitanes,+177,+28109+Alcobendas,+Madrid,+Comunidad+de+Madrid,+Espa%C3%B1a&amp;ll=40.525201,-3.604782&amp;spn=0.00212,0.006427&amp;z=17" target="blank">Ver en Google maps <img style="padding: 0pt;" class="ext" title="Enlace externo" alt="Enlace externo" src="/sites/default/files/imgs/link_azul.gif" width="8" height="9" rel="lightbox"></a></span></p>\r\n </div>\r\n</div>\r\n<p>&nbsp;</p>\r\n';
    $content[2] = '<div class="rss-item"><img alt="Icono RSS" rel="lightbox" src="/sites/all/themes/entrelineas/images/RSS.gif"> <span class="titulorss"><a href="http://www.revistaentrelineas.es/23/rss" title="RSS Ultimas noticias">Síguenos por RSS</a> </span>\r\n <div class="clear">&nbsp;</div>\r\n <p><em>Entrelíneas</em> incorpora esta tecnología para facilitarte el acceso a la actualización de las últimas novedades publicadas en la revista, sin necesidad de entrar en la página web.</p>\r\n  <p>Para actualizar las fuentes RSS puedes instalar un programa llamado \'\'agregador\'\' o lector de noticias, que ya incluyen las últimas versiones de los navegadores, o &nbsp;agregar los RSS a tus servicios web favoritos.</p>\r\n <p>Copia el enlace RSS (<a href="http://www.revistaentrelineas.es/24/rss">http://www.revistaentrelineas.es/24/rss</a>) y añádelo a tu servicio de lectura de titulares. También puedes seleccionar una de estas imágenes y añadir en tu web las noticias de <em>Entrelíneas</em> en RSS.</p>\r\n  <ul class="lista-rss">\r\n    <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-google.gif"><a href="http://www.google.com/ig/add?feedurl=http://www.revistaentrelineas.es/24/rss">iGoogle</a></li>\r\n    <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-yahoo.gif"><a href="http://add.my.yahoo.com/content?url=http://www.revistaentrelineas.es/24/rss">My Yahoo!</a></li>\r\n    <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-wlive.gif"><a href="https://live.com/Default.aspx?add=http://www.revistaentrelineas.es/24/rss">Windows live</a></li>\r\n   <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-net.gif"><a href="http://www.netvibes.com/es">Netvibes</a></li>\r\n    <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-planet.gif"><a href="http://www.planetaki.com/subscription/add?url=http://www.revistaentrelineas.es/24/rss.xml">Planetaki</a></li>\r\n   <li><img alt="" rel="lightbox" src="/sites/all/themes/entrelineas/images/ico-wiki.gif"><a href="http://www.wikio.es/subscribe?url=http://www.revistaentrelineas.es/24/rss">Wikio</a></li>\r\n </ul>\r\n</div>\r\n<p>&nbsp;</p>\r\n';
    $content[3] = '<?php \r\n//:::::::::::::::::::::::::::::::  MENU PARA EL MAPA WEB  ::::::::::::::::::::::::::::::::::::::::::::::::\r\n//::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\n \r\nfunction entrelineas_menu_map_tree($menu_name = \'\'main-menu\'\') {\r\n  static $menu_output = array();\r\n\r\n  if (!isset($menu_output[$menu_name])) {\r\n    $tree = menu_tree_page_data($menu_name);\r\n    $menu_output[$menu_name] = entrelineas_menu_mapa_output($tree);\r\n  }\r\n  return $menu_output[$menu_name];\r\n}\r\n\r\nfunction entrelineas_menu_mapa_output($tree) {\r\n  $output = \'\'\'\';\r\n  $items = array();\r\n\r\n  // Pull out just the menu items we are going to render so that we\r\n  // get an accurate count for the first/last classes.\r\n  foreach ($tree as $data) {\r\n    if (!$data[\'\'link\'\'][\'\'hidden\'\']) {\r\n      $items[] = $data;\r\n    }\r\n  }\r\n\r\n  $num_items = count($items);\r\n  foreach ($items as $i => $data) {\r\n    $extra_class = array();\r\n    if ($i == 0) {\r\n      $extra_class[] = \'\'first\'\';\r\n    }\r\n    if ($i == $num_items - 1) {\r\n      $extra_class[] = \'\'last\'\';\r\n    }\r\n    $extra_class = implode(\'\' \'\', $extra_class);\r\n\r\n    $link = entrelineas_mapa_item_link($data[\'\'link\'\']);\r\n\r\n    if ($data[\'\'below\'\']) {\r\n      $output .= entrelineas_mapa_item($link, $data[\'\'link\'\'][\'\'has_children\'\'], entrelineas_menu_mapa_output($data[\'\'below\'\']), $data[\'\'link\'\'][\'\'in_active_trail\'\'], $extra_class);\r\n    }\r\n    else {\r\n      $output .= entrelineas_mapa_item($link, $data[\'\'link\'\'][\'\'has_children\'\'], \'\'\'\', $data[\'\'link\'\'][\'\'in_active_trail\'\'], $extra_class);\r\n    }\r\n  }\r\n  return $output ? entrelineas_mapa_tree($output) : \'\'\'\';\r\n}\r\n\r\n\r\nfunction entrelineas_mapa_tree($tree) {\r\n  return \'\'<ul class="menu">\'\'. $tree .\'\'</ul>\'\';\r\n}\r\n\r\nfunction entrelineas_mapa_item_link($link) {\r\n  if (empty($link[\'\'localized_options\'\'])) {\r\n    $link[\'\'localized_options\'\'] = array();\r\n  }\r\n\r\n  return l($link[\'\'title\'\'], $link[\'\'href\'\'], $link[\'\'localized_options\'\']);\r\n}\r\n\r\n\r\nfunction entrelineas_mapa_item($link, $has_children, $menu = \'\'\'\', $in_active_trail = FALSE, $extra_class = NULL) {\r\n  $class = ($menu ? \'\'expanded\'\' : ($has_children ? \'\'collapsed\'\' : \'\'leaf\'\'));\r\n  if (!empty($extra_class)) {\r\n    $class .= \'\' \'\'. $extra_class;\r\n  }\r\n  if ($in_active_trail) {\r\n    $class .= \'\' active-trail\'\';\r\n  }\r\n  return \'\'<li class="\'\'. $class .\'\'">\'\'. $link . $menu ."</li>\\n";\r\n}\r\n\r\n\r\n//::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\n//::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::\r\n\r\n\r\n\r\n?>\r\n<div class="clearfix margenTop10"><div class="inicio"><h2><a href="<?php echo $base_url; ?>/18/home">Inicio</a></h2></div></div>\r\n<div class="mapaweb-secciones">\r\n<div class="secciones"><h2 class="blanco">Secciones</h2></div>\r\n<?php \r\n  print entrelineas_menu_map_tree($menu_name = \'\'main-menu\'\');\r\n?>\r\n</div>\r\n<div class="mapaweb-generico margenIzq25">\r\n<div class="otros"><h2 class="blanco">Otros</h2></div>\r\n<?php\r\n print entrelineas_menu_map_tree($menu_name = \'\'menu-menu-footer\'\'); \r\n?>\r\n</div>\r\n';
    $content[4] = '<div style="MARGIN-TOP: 10px">\r\n  <div class="columna columnas-3">\r\n    <p>El usuario se compromete a utilizar los servicios proporcionados por <em>Entrelíneas</em>, revista digital de Red Eléctrica de España, S.A.U., de conformidad con la ley, con las presentes condiciones generales, así como con las prácticas generalmente aceptadas en Internet. El usuario se obliga a abstenerse de utilizar los servicios con fines o efectos ilícitos o contrarios a lo establecido en las condiciones generales.</p>\r\n   <p>El usuario está de acuerdo y tiene presente que en los servicios de foro, comentarios de noticias, votaciones, envíos de información a través de formularios, así como &nbsp;cualesquiera otros que permitan la publicación de las opiniones de los usuarios, no se aceptan anuncios, cadenas de mensajes de correo electrónico o cualquier otro contenido que no sea opinar o debatir sobre artículos o noticias. Al utilizar los servicios, el usuario manifiesta su conformidad con estas condiciones generales, comprometiéndose a no utilizarlos para enviar mensajes que difamen o insulten, o que contengan información falsa, que sea inapropiada, abusiva, dañina, pornográfica, amenazadora, dañando la imagen pública y/o la vida privada de terceras personas o que por alguna causa infrinjan alguna ley.</p>\r\n   <p style="word-spacing: -2px;">En particular, y a título meramente indicativo y no exhaustivo, el usuario se compromete a no captar datos con finalidad publicitaria, a no enviar ningún tipo de publicidad <em>online</em> y a no transmitir, difundir o poner a disposición de terceros, a través de los servicios proporcionados por <em>Entrelíneas</em>, informaciones, mensajes, gráficos, archivos de sonido y/o imagen, fotografías, grabaciones, <em>software</em> y en general cualquier clase de material, datos o contenidos que:</p>\r\n </div>\r\n  <div class="columna columnas-3">\r\n    <p>(a) de cualquier forma contravengan, menosprecien o atenten contra los derechos fundamentales y libertades públicas reconocidas constitucionalmente, en los tratados internacionales y en el resto del ordenamiento jurídico;</p>\r\n    <p style="word-spacing: -1pt;">(b) induzcan, inciten o promuevan actuaciones delictivas, denigratorias, difamatorias o violentas;</p>\r\n   <p style="word-spacing: -2px;">(c) induzcan, inciten o promuevan actuaciones, actitudes o ideas discriminatorias por razón de sexo, raza, religión, creencias o edad;</p>\r\n   <p>(d) incorporen mensajes delictivos, violentos o degradantes;</p>\r\n   <p>(e) induzcan o inciten a involucrarse en prácticas peligrosas, de riesgo o nocivas para la salud y el equilibrio psíquico;</p>\r\n   <p>(f) sean falsos, ambiguos, inexactos, exagerados o extemporáneos, de forma que puedan inducir a error sobre su objeto o sobre las intenciones o&nbsp;propósitos del comunicante;</p>\r\n   <p>(g) se encuentren protegidos por cualesquiera derechos de propiedad intelectual o industrial pertenecientes a terceros, sin que el usuario haya obtenido previamente de sus titulares la autorización necesaria para llevar a cabo el uso que hace o pretende hacer;</p>\r\n   <p>(h) violen los secretos empresariales de terceros;</p>\r\n   <p>(i) sean contrarios al derecho al honor, a la intimidad personal y familiar o a la propia imagen de las personas;</p>\r\n  </div>\r\n  <div class="columna columnas-3">\r\n    <p>(j) infrinjan la normativa sobre secreto de las comunicaciones;</p>\r\n    <p>(k) provoquen por sus características (como formato, extensión, etc.) dificultades en el normal funcionamiento de los servicios;</p>\r\n   <p>(l) contengan errores gramaticales, faltas de ortografía que dificulten su comprensión o lenguaje ofensivo.</p>\r\n    <em>Entrelíneas</em>&nbsp; se reserva el&nbsp; derecho&nbsp; a&nbsp; denegar la utilización de los servicios y a retirar las informaciones,&nbsp; datos y&nbsp; contenidos difundidos o puestos a&nbsp;&nbsp; disposición de&nbsp; terceros &nbsp; a través de cualquiera de estos servicios, en cualquier momento y&nbsp; sin necesidad de previo aviso a aquellos usuarios que incumplan estas condiciones generales. <em>Entrelíneas</em> podrá eliminar aquellos mensajes que considere inapropiados,&nbsp; fuera de contexto o que no tengan continuidad con el debate. <em>Entrelíneas</em> no se hace responsable&nbsp; del contenido de las opiniones publicadas por los usuarios.</div>\r\n</div>\r\n';
  }

$query = 'INSERT INTO `'.$number.'_field_data_body` (`entity_type`, `bundle`, `deleted`, `entity_id`, `revision_id`, `language`, `delta`, `body_value`, `body_summary`, `body_format`) VALUES
(\'node\', \'article\', 0, 36, 36, \'und\', 0, \''.$content[0].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 47, 47, \'und\', 0, \''.$content[1].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 48, 48, \'und\', 0, \''.$content[2].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 49, 49, \'und\', 0, \''.$content[3].'\' , \'\', \'php_code\'),
(\'node\', \'article\', 0, 50, 50, \'und\', 0, \''.$content[4].'\' , \'\', \'full_html\');';

try {
db_query($query);
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 1.'), 'error'); }

$query = 'INSERT INTO `'.$number.'_field_revision_body` (`entity_type`, `bundle`, `deleted`, `entity_id`, `revision_id`, `language`, `delta`, `body_value`, `body_summary`, `body_format`) VALUES
(\'node\', \'article\', 0, 36, 36, \'und\', 0, \''.$content[0].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 47, 47, \'und\', 0, \''.$content[1].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 48, 48, \'und\', 0, \''.$content[2].'\' , \'\', \'full_html\'),
(\'node\', \'article\', 0, 49, 49, \'und\', 0, \''.$content[3].'\' , \'\', \'php_code\'),
(\'node\', \'article\', 0, 50, 50, \'und\', 0, \''.$content[4].'\' , \'\', \'full_html\');';

try {
db_query($query);
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 2.'), 'error'); }

//texto_imprimible
  $results = get_data($number,'field_data_field_texto_imprimible',array(36,47,48,49,50));
  if($results){
    $content = $results;
  }else{
    $content[0] = '<h2>\'\'Entrelíneas\'\'</h2>\r\n<p>Director: Antonio Prada Ramos.<br>\r\n Subdirectora: Nuria Santos de la Calle.<br>\r\n Coordinación: Susana Moreno Martínez.<br>\r\n Edición: Gabinete de Prensa de Red Eléctrica de España.<br>\r\n Dirección: Paseo del Conde de los Gaitanes, 177. 28109 Alcobendas. Madrid.<br>\r\n  Teléfono: 91 650 85 00.<br>\r\n Fax: 91 659 99 25.<br>\r\n  Correo-e: <a href="mailto:ree@revistaentrelineas.es">ree@revistaentrelineas.es</a></p>\r\n<h2>Colaboración:</h2>\r\n<p>Desarrollo: OpenSistemas, S.L.<br>\r\n Dirección: Calle Castrobarto, 10. 28042 Madrid.<br>\r\n Teléfono: 902 107 396.<br>\r\n  Fax: 91 329 58 89.<br>\r\n  Correo-e: info@opensistemas.com</p>\r\n<p>&nbsp;</p>\r\n<p>Esta publicación no comparte necesariamente la opinión de sus colaboradores y se limita a ofrecer sus páginas con respeto a la libertad de expresión. La información recogida en esta revista puede ser usada en parte o en su integridad citando la fuente.</p>\r\n';
    $content[1] = '<div>\r\n<h2>Gabinete de Prensa</h2>\r\n\r\nDirección:<br>\r\nPaseo del Conde de los Gaitanes, 177.</br>\r\n28109 Alcobendas. Madrid.<br>\r\n<br>\r\nTeléfono: 91 650 85 00.<br>\r\n <br>\r\nFax: 91 659 99 25.<br>\r\n <br>\r\nCorreo-e:<br>\r\n<a href="mailto:ree@revistaentrelineas.es">ree@revistaentrelineas.es</a><br>\r\n<a href="mailto:gabinetedeprensa@ree.es">gabinetedeprensa@ree.es</a><br>\r\n<br>\r\n...\r\n<br>\r\n</div>\r\n\r\n';
    $content[2] = '<p>Síguenos por RSS</p>\r\n<p>Entrelíneas incorpora esta tecnología para facilitarte el acceso a la actualización de las últimas novedades publicadas en la revista, sin necesidad de entrar en la página web.</p>\r\n<p>Para actualizar las fuentes RSS puedes instalar un programa llamado \'\'agregador\'\' o lector de noticias, que ya incluyen las últimas versiones de los navegadores, o agregar los RSS a tus servicios web favoritos.</p>\r\n<p>Copia el enlace RSS&nbsp;(<a href="http://www.revistaentrelineas.es/24/rss">http://www.revistaentrelineas.es/24/rss</a>)&nbsp;y añádelo a tu servicio de lectura de titulares.</p>\r\n';
    $content[3] = '<div class="content clearfix">\r\n  <div style="text-align: justify;">\r\n    <div class="clearfix margenTop10">\r\n      <div class="inicio">\r\n        <h2><a href="/18/home">Inicio</a></h2>\r\n      </div>\r\n    </div>\r\n    <div class="mapaweb-secciones">\r\n     <div class="secciones">\r\n       <h2 class="blanco">Secciones</h2>\r\n     </div>\r\n      <ul class="menu">\r\n       <li class="leaf first"><a title="Viajar para conocer" href="/editorial/viajar-para-conocer">Editorial</a></li>\r\n        <li class="leaf"><a title="" href="/noticias-agenda">Noticias y agenda</a></li>\r\n       <li class="expanded"><a href="/observatorios">Observatorios</a>\r\n         <ul class="menu">\r\n           <li class="leaf first"><a title="La demanda de energía eléctrica desciende un 1,2% en el 2011" href="/observatorios/la-demanda-de-energia-electrica-desciende-un-1-en-el-2011">Observatorio energético</a></li>\r\n           <li class="leaf last"><a title="Red Eléctrica impulsa las buenas prácticas de gobierno corporativo" href="/observatorios/red-electrica-impulsa-las-buenas-practicas-de-gobierno-corporativo">Observatorio financiero</a></li>\r\n         </ul>\r\n       </li>\r\n       <li class="expanded"><a href="/entrevistas">Entrevistas</a>\r\n         <ul class="menu">\r\n           <li class="leaf first"><a title="“La batería del coche eléctrico puede almacenar energía de la red para equilibrar la demanda”" href="/entrevistas/c-c-chan">La Entrevista</a></li>\r\n           <li class="leaf last"><a title=\'\'"Se canta con la cabeza"\'\' href="/entrevistas/angeles-blancas">Gente con energía</a></li>\r\n          </ul>\r\n       </li>\r\n       <li class="expanded"><a href="/entretemas">Entretemas</a>\r\n         <ul class="menu">\r\n           <li class="leaf first"><a title="" href="/entretemas/reportajes">Reportajes</a></li>\r\n            <li class="leaf"><a title="La universidad en tiempos revueltos" href="/entretemas/la-universidad-en-tiempos-revueltos">Debate</a></li>\r\n            <li class="leaf last"><a href="/entretemas/la-quimio-jugando-se-pasa-volando">Iniciativas solidarias</a></li>\r\n         </ul>\r\n       </li>\r\n       <li class="expanded"><a href="/tiempo-libre">Tiempo libre</a>\r\n         <ul class="menu">\r\n           <li class="leaf first"><a title="De cráter en cráter por La Palma" href="/tiempo-libre/de-crater-en-crater-por-la-palma">Viajes</a></li>\r\n            <li class="leaf last"><a title="" href="/tiempo-libre/libros">Libros</a></li>\r\n         </ul>\r\n       </li>\r\n       <li class="collapsed last"><a title="Sinfonía en red mayor" href="/firma-invitada/sinfonia-en-red-mayor">Firma invitada</a></li>\r\n      </ul>\r\n   </div>\r\n    <div class="mapaweb-generico margenIzq25">\r\n      <div class="otros">\r\n       <h2 class="blanco">Otros</h2>\r\n     </div>\r\n      <ul class="menu">\r\n       <li class="leaf first"><a href="/quienes-hacemos-entrelineas-digital">Quiénes hacemos `Entrelíneas´ digital</a></li>\r\n        <li class="leaf"><a href="/contacto">Contacto</a></li>\r\n        <li class="leaf"><a href="http://www.revistaentrelineas.es/23/rss.xml">RSS</a></li>\r\n       <li class="leaf active-trail"><a class="active" href="/mapa-web">Mapa web</a></li>\r\n        <li class="leaf"><a href="http://www.ree.es/ayuda/aviso_legal.asp" target="_blank">Aviso legal</a></li>\r\n       <li class="leaf"><a href="/normas-de-participacion">Normas de participación</a></li>\r\n        <li class="leaf last"><a href="http://www.ree.es/" target="_blank">www.ree.es</a></li>\r\n      </ul>\r\n   </div>\r\n  </div>\r\n</div>\r\n';
    $content[4] = '<p>El&nbsp;usuario se compromete a utilizar los servicios proporcionados por&nbsp;Entrelíneas, revista digital de Red Eléctrica de España, S.A.U., de conformidad con la ley, con las presentes condiciones generales, así como con las prácticas generalmente aceptadas en Internet. El usuario se obliga a abstenerse de utilizar los servicios con fines o efectos ilícitos o contrarios a lo establecido en las condiciones generales.</p>\r\n<p>El usuario está de acuerdo y tiene presente que en los servicios de foro, comentarios de noticias, votaciones, envíos de información a través de formularios, así como &nbsp;cualesquiera otros que permitan la publicación de las opiniones de los usuarios, no se aceptan anuncios, cadenas de mensajes de correo electrónico o cualquier otro contenido que no sea opinar o debatir sobre artículos o noticias. Al utilizar los servicios, el usuario manifiesta su conformidad con estas condiciones generales, comprometiéndose a no utilizarlos para enviar mensajes que difamen o insulten, o que contengan información falsa, que sea inapropiada, abusiva, dañina, pornográfica, amenazadora, dañando la imagen pública y/o la vida privada de terceras personas o que por alguna causa infrinjan alguna ley.</p>\r\n<p>En particular, y a título meramente indicativo y no exhaustivo, el usuario se compromete a no captar datos con finalidad publicitaria, a no enviar ningún tipo de publicidad&nbsp;online&nbsp;y a no transmitir, difundir o poner a disposición de terceros a través de los servicios proporcionados por&nbsp;Entrelíneas, informaciones, mensajes, gráficos, archivos de sonido y/o imagen, fotografías, grabaciones,&nbsp;software&nbsp;y en general cualquier clase de material, datos o contenidos que:</p>\r\n<p>(a) de cualquier forma contravengan, menosprecien o atenten contra los derechos fundamentales y libertades públicas reconocidas constitucionalmente, en los tratados internacionales y en el resto del ordenamiento jurídico;</p>\r\n<p>(b) induzcan, inciten o promuevan actuaciones delictivas, denigratorias, difamatorias o violentas;</p>\r\n<p>(c) induzcan, inciten o promuevan actuaciones, actitudes o ideas discriminatorias por razón de sexo, raza, religión, creencias o edad;</p>\r\n<p>(d) incorporen mensajes delictivos, violentos o degradantes;</p>\r\n<p>(e) induzcan o inciten a involucrarse en prácticas peligrosas, de riesgo o nocivas para la salud y el equilibrio psíquico;</p>\r\n<p>(f) sean falsos, ambiguos, inexactos, exagerados o extemporáneos, de forma que puedan inducir a error sobre su objeto o sobre las intenciones o propósitos del&nbsp;comunicante;</p>\r\n<div>\r\n <p>(g) se encuentren protegidos por cualesquiera derechos de propiedad intelectual o industrial pertenecientes a terceros, sin que el usuario haya obtenido previamente de sus titulares la autorización necesaria para llevar a cabo el uso que hace o pretende hacer;</p>\r\n <p>(h) violen los secretos empresariales de terceros;</p>\r\n <p>(i) sean contrarios al derecho al honor, a la intimidad personal y familiar o a la propia imagen de las personas;</p>\r\n  <p>(j) infrinjan la normativa sobre secreto de las comunicaciones;</p>\r\n  <p>(k) provoquen por sus características (como formato, extensión, etc.) dificultades en el normal funcionamiento de los servicios;</p>\r\n <p>(l) contengan errores gramaticales, faltas de ortografía que dificulten su comprensión o lenguaje ofensivo.</p>\r\n</div>\r\n<div>Entrelíneas se reserva el derecho a denegar la utilización de los servicios y a retirar las informaciones, datos y contenidos difundidos o puestos a disposición de terceros a través de cualquiera de estos servicios, en cualquier momento y sin necesidad de previo aviso a aquellos usuarios que incumplan estas condiciones generales.&nbsp;Entrelíneas&nbsp;podrá eliminar aquellos mensajes que considere inapropiados, fuera de contexto o que no tengan continuidad con el debate.&nbsp;Entrelíneas&nbsp;no se hace responsable del contenido de las opiniones publicadas por los usuarios.</div>\r\n';
}

$query = 'INSERT INTO `'.$number.'_field_data_field_texto_imprimible` (`entity_type`, `bundle`, `deleted`, `entity_id`, `revision_id`, `language`, `delta`, `field_texto_imprimible_value`, `field_texto_imprimible_format`) VALUES
(\'node\', \'article\', 0, 36, 36, \'und\', 0, \''.$content[0].'\' , \'full_html\'),
(\'node\', \'article\', 0, 47, 47, \'und\', 0, \''.$content[1].'\' , \'filtered_html\'),
(\'node\', \'article\', 0, 48, 48, \'und\', 0, \''.$content[2].'\' , \'full_html\'),
(\'node\', \'article\', 0, 49, 49, \'und\', 0, \''.$content[3].'\' , \'full_html\'),
(\'node\', \'article\', 0, 50, 50, \'und\', 0, \''.$content[4].'\' , \'full_html\');';

try {
db_query($query);
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 3.'), 'error'); }

$query = 'INSERT INTO `'.$number.'_field_revision_field_texto_imprimible` (`entity_type`, `bundle`, `deleted`, `entity_id`, `revision_id`, `language`, `delta`, `field_texto_imprimible_value`, `field_texto_imprimible_format`) VALUES
(\'node\', \'article\', 0, 36, 36, \'und\', 0, \''.$content[0].'\' , \'full_html\'),
(\'node\', \'article\', 0, 47, 47, \'und\', 0, \''.$content[1].'\' , \'filtered_html\'),
(\'node\', \'article\', 0, 48, 48, \'und\', 0, \''.$content[2].'\' , \'full_html\'),
(\'node\', \'article\', 0, 49, 49, \'und\', 0, \''.$content[3].'\' , \'full_html\'),
(\'node\', \'article\', 0, 50, 50, \'und\', 0, \''.$content[4].'\' , \'full_html\');';

try {
db_query($query);
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 4.'), 'error'); }

// node
try {
db_query("INSERT INTO `".$number."_node` (`nid`, `vid`, `type`, `language`, `title`, `uid`, `status`, `created`, `changed`, `comment`, `promote`, `sticky`, `tnid`, `translate`) VALUES
(36, 36, 'article', 'es', 'Quiénes hacemos `Entrelíneas´ digital', 1, 1, 1325022525, 1343640151, 1, 1, 0, 0, 0),
(47, 47, 'article', 'es', 'Contacto', 1, 1, 1325670354, 1343640391, 1, 1, 0, 0, 0),
(48, 48, 'article', 'es', 'RSS', 1, 1, 1325670966, 1343731714, 1, 1, 0, 0, 0),
(49, 49, 'article', 'es', 'Mapa web', 1, 1, 1325671118, 1343645538, 1, 1, 0, 0, 0),
(50, 50, 'article', 'es', 'Normas de participación', 1, 1, 1325671348, 1343731847, 1, 1, 0, 0, 0);");
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 5.'), 'error'); }

try {
db_query("INSERT INTO `".$number."_node_revision` (`nid`, `vid`, `uid`, `title`, `log`, `timestamp`, `status`, `comment`, `promote`, `sticky`) VALUES
(36, 36, 270, 'Quiénes hacemos `Entrelíneas´ digital', '', 1343640151, 1, 1, 1, 0),
(47, 47, 270, 'Contacto', '', 1343640391, 1, 1, 1, 0),
(48, 48, 270, 'RSS', '', 1343731714, 1, 1, 1, 0),
(49, 49, 270, 'Mapa web', '', 1343645538, 1, 1, 1, 0),
(50, 50, 270, 'Normas de participación', '', 1343731847, 1, 1, 1, 0);");
}catch(Exception $e) { drupal_set_message(t('An error occurred and processing did not complete in insert 6.'), 'error'); }

}

/**
* Create folder, setting file and symlink
*/
function create_directory($number) {
  global $base_url;
  $dom = str_replace('http://','',$base_url);
  $directory = $_SERVER['DOCUMENT_ROOT'].'/sites/'.$dom.'.'.$number;
  $perm = 0755;
  
  if(!mkdir ( $directory , $perm , true ))
  {
      drupal_set_message(t('Fallo al crear carpetas...'),'error');
  }

  symlink ( '.' , $number );
}

function create_setting_file($number,$date,$year,$bbdd,$user,$pass){
  $path_module = drupal_get_path('module', 'new_num');
  $fichero = $path_module.'/settings.tpl.php';
  
  if (file_exists ($fichero)){
    global $base_url;
    $dom = str_replace('http://','',$base_url);
    //Intentamos abrir el fichero.
    if ($ficheroabierto = fopen ($fichero, "r")){
      $contenido_fichero = fread($ficheroabierto, filesize($fichero));
      $contenido_fichero = str_replace('##NUMBER##', $number , $contenido_fichero );
      $contenido_fichero = str_replace('##DATE##', $date , $contenido_fichero );
      $contenido_fichero = str_replace('##YEAR##', $year , $contenido_fichero );
      $contenido_fichero = str_replace('##BBDD##', $bbdd , $contenido_fichero );
      $contenido_fichero = str_replace('##USERNAME##', $user , $contenido_fichero );
      $contenido_fichero = str_replace('##PASS##', $pass , $contenido_fichero );
      fclose($ficheroabierto);
    } else {
     drupal_set_message(t('El fichero no ha podido ser abierto'),'error');
    }
  } else {
    drupal_set_message(t('El fichero no existe'),'error');
  }
  $fichero = $_SERVER['DOCUMENT_ROOT'].'/sites/'.$dom.'.'.$number.'/settings.php';
  $setting = fopen($fichero, 'w');
  fwrite($setting, $contenido_fichero);
  fclose($setting);
  chmod($fichero, 755);

}